<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KenariCoin (KN)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-yellow-100 to-white flex flex-col items-center justify-center p-6">

  <!-- Header -->
  <h1 class="text-4xl font-bold text-gray-800 mb-6">KenariCoin (KN)</h1>

  <!-- Wallet + Action Buttons -->
  <div class="flex flex-col gap-4 items-center">
    <button id="connectBtn" class="rounded-2xl px-6 py-3 text-lg bg-yellow-400 hover:bg-yellow-500 text-white font-bold shadow-lg transition">
      Connect Wallet
    </button>
    <button id="balanceBtn" class="rounded-2xl px-6 py-3 text-lg bg-green-500 hover:bg-green-600 text-white font-bold shadow-lg transition hidden">
      Check Balance
    </button>
    <button id="buyBtn" class="rounded-2xl px-6 py-3 text-lg bg-blue-500 hover:bg-blue-600 text-white font-bold shadow-lg transition hidden">
      Buy KN
    </button>
    <p id="balanceText" class="text-gray-700 font-medium"></p>
  </div>

  <script>
    const tokenAddress = "0x0B70E29a77775E9aa2F7A7c66C371B411d4D685c"; // kontrak KenariCoin
    const tokenABI = [
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)"
    ];

    let provider, signer, account;

    async function connectWallet() {
      if (typeof window.ethereum === "undefined") {
        alert("MetaMask tidak ditemukan. Silakan install MetaMask.");
        return;
      }
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        account = await signer.getAddress();
        document.getElementById("connectBtn").innerText =
          "Connected: " + account.slice(0, 6) + "..." + account.slice(-4);

        document.getElementById("balanceBtn").classList.remove("hidden");
        document.getElementById("buyBtn").classList.remove("hidden");
      } catch (err) {
        console.error("Wallet connect error:", err);
      }
    }

    async function checkBalance() {
      if (!provider || !account) {
        alert("Connect wallet dulu.");
        return;
      }
      const contract = new ethers.Contract(tokenAddress, tokenABI, provider);
      const balance = await contract.balanceOf(account);
      const decimals = await contract.decimals();
      const symbol = await contract.symbol();
      const formatted = ethers.utils.formatUnits(balance, decimals);
      document.getElementById("balanceText").innerText =
        `Your Balance: ${formatted} ${symbol}`;
    }

    function buyToken() {
      window.open(
        `https://pancakeswap.finance/swap?outputCurrency=${tokenAddress}`,
        "_blank"
      );
    }

    // Event listener
    document.getElementById("connectBtn").addEventListener("click", connectWallet);
    document.getElementById("balanceBtn").addEventListener("click", checkBalance);
    document.getElementById("buyBtn").addEventListener("click", buyToken);
  </script>
</body>
</html>
